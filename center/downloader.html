<!DOCTYPE html>
<html lang="ko">

<head>
	<!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-130136264-12"></script>
	<script>
	  window.dataLayer = window.dataLayer || [];
	  function gtag(){dataLayer.push(arguments);}
	  gtag('js', new Date());
	
	  gtag('config', 'UA-130136264-12');
	</script>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link href="css/style.css" rel="stylesheet">
	<link href="css/sb-admin-2.min.css" rel="stylesheet">
	<title>DUNI PILOT Center</title>	
</head>
<body>

<body id="page-top">
	<div id="wrapper">
		<div id="content-wrapper" class="d-flex flex-column">     
     	<div id="content">
     		<div class="container-fluid">          
          <div class="row">
						 <div class="col-xl-12 col-md-12 mb-4">
				     		<div class="card shadow py-2">
	                <div class="card-body text-center">
	                	<a href="/index.html" class="d-sm-inline-block btn btn-sm btn-info shadow-sm" id="record_name_field">DUNI PILOT Center </a>
	                </div>
	              </div>
	              
	              <div class="card shadow py-2">	                
	                <div class="card-body text-center">	                	
	                	<div class="col">
	                		<img src="../images/loader.gif" border=0> <img src="../images/loader.gif" border=0>
	                	</div>
	                	<div class="col">
	                		<img src="./imgs/duni_logo.png" border=0>
	                	</div>
	                	<div class="col">
	                		<img src="../images/loader.gif" border=0> <img src="../images/loader.gif" border=0>
	                	</div>
	                </div>
								</div>
     				 </div>
    			</div>
    		</div>
    	</div>
    </div>
	</div>

<script>
let file_url = getQueryVariable();

if (file_url == "") {
	alert("Invalid access");
	location.href="/index.html";
}
else {
	downloadFile(file_url);	
}

function downloadFile(file_url) {
	let temp_file_name = file_url.substring(file_url.lastIndexOf("/") + 1).split("?")[0];
	var xhrObj = new XMLHttpRequest();
	xhrObj.responseType = 'blob';
	xhrObj.onload = function () {
	    var linker = document.createElement('a');
	    linker.href = window.URL.createObjectURL(xhrObj.response);
	    linker.download = temp_file_name;
	    linker.style.display = 'none';    
	    document.body.appendChild(linker);
	    linker.click();
	    delete linker;
	};
	xhrObj.open('GET', file_url);
	xhrObj.send();
}

function getQueryVariable() {
    var query = window.location.search.substring(1);
    var vars = query.split('&');
    for (var i = 0; i < vars.length; i++) {
        var pair = vars[i].split('=');
        if (decodeURIComponent(pair[0]) == "id") {
            return "https://s3.ap-northeast-2.amazonaws.com/io.droneplay/temp_user_files/" + decodeURIComponent(pair[1]);
        }
    }
    
    return "";
}

</script>
</body>
</html>